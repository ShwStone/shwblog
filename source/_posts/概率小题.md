---
title: 概率小题
date: 2023-12-04 13:27:26
tags:
  - 数学
  - 概率论
categories:
  - 数学
  - 概率论
comments: true
sticky: 20
---

---

<!--more-->

## 范围

贝叶斯公式，全概率公式。

简单推导连续情况下的贝叶斯公式：

回顾概率密度函数的定义：$p(u)$ 是 $P(x \le u)$ 的导数。所以我们能把 $p(u)$ 写成一个极限的形式：$p(u)=\lim_{u_1 \to u^-}\frac{P(u_1\le x\le u)}{u-u_1}$。

这样，我们有：

$$
\begin{aligned}
\frac{P_{x\mid y}(u_1\le x\le u \mid v_1\le y \le v)}{u-u_1} &= \frac{P_{y\mid x}(v_1\le y \le v \mid u_1\le x\le u)P_x(u_1\le x\le u)}{P_y(v_1\le y \le v)(u-u_1)} \\
&= \frac{\frac{P_{y\mid x}(v_1\le y \le v \mid u_1\le x\le u)}{v-v_1}P_x(u_1\le x\le u)}{\frac{P_y(v_1\le y \le v)}{v-v_1}(u-u_1)}
\end{aligned}
$$

令 $u_1 \to u^-,v_1 \to v^-$，则有：

$$
p_{x\mid y}(u \mid v)=\frac{p_{y \mid x}(v \mid u)p_x(u)}{p_y(v)}
$$

## 自己 YY 的题目

将一伯努利事件重复 $2n$ 次，恰好得到 $n$ 次正例和 $n$ 次反例，求正例概率 $q$ 满足 $q \in [0.4, 0.6]$ 的概率是多少？

在试验开始之前，我们可以对 $q$ 所遵从的概率分布做一个先验假设。假设 $Pr(q \in [0, x])=\int_0^xp(q) \mathrm dq$，即 $q$ 遵循概率密度函数为 $p$ 的分布。一个合理的猜想是平均分布 $p(q)=1$。

为了方便，我们用 $A$ 表示事件“恰好得到 $n$ 次正例和 $n$ 次反例”。

显然，$A$ 是一个典型的二项分布。如果我们已知 $q$，则可以知道 $P(A|q)=C_{2n}^nq^n(1-q)^n$。

则我们要求出的是 $p(q \mid A)$。使用针对连续型随机变量的贝叶斯公式以及全概率公式，我们得到：

$$
\begin{aligned}
p(q \mid A) &= \frac{P(A \mid q)p(q)}{P(A)} \\
&= \frac{P(A\mid q)p(q)}{\int_0^1P(A \mid u)p(u)\mathrm du} \\
&= \frac{P(A \mid q)p(q)}{P(A)} \\
&= \frac{C_{2n}^nq^n(1-q)^np(q)}{\int_0^1C_{2n}^nu^n(1-u)^np(u)\mathrm du} \\
&= \frac{q^n(1-q)^np(q)}{\int_0^1u^n(1-u)^np(u)\mathrm du}
\end{aligned} 
$$

运用 Beta 函数定积分，得到： $p(q \mid A)= q^n(1-q)^np(q)\frac{(2n+1)!}{(n!)^2}$。

如果假设先验分布是平均分布，则我们要求的结果为：

$$
\frac{(2n+1)!}{(n!)^2}\int_{0.4}^{0.6}q^n(1-q)^n\mathrm dq
$$

这个东西没有闭合形式，但是我们可以快速验证完备性：当积分上下界是 0 和 1 时，结果是 1；当我们取 $n=5$ 时，得到结果大约 $0.506$，说明少量样本并不具有说服力；而当 $n=100$ 时，结果接近为 1。

![](/images/msp206811718cahb33di9bcb00000d272ab88b0ibc42.gif)

一个有趣的事实是，无论一开始的先验假设如何，只要没有一处函数值为 0，则最终我们的结果都会变成 1。这体现了实验是如何一步步改变我们的观点的。

## 概率论基础教程

### 例 3o

这个例子极好地说明了“普通直觉”与“概率直觉”的区别。

在一个 $10^6$ 个人的小镇里，过去十年共有 $10^4$ 人犯罪（不养闲人）。发生了一起恶性案件，检察官认为，**某一个**有犯罪记录的人犯下这桩案件的概率是**某一个**没有犯罪记录的人犯下这桩案件的概率的 $c$ 倍。现在，法医提供了新证据：在现场采集到了罪犯的 5 个关键 DNA 片段，正常人同时拥有这五个 DNA 片段的概率是 $10^{-5}$。警方掌握有犯罪记录的人的 DNA 库，立即进行了匹配，发现犯过罪的人中只有 A 匹配了 5 个片段。
如果检察官一开始的推测是正确的，那么在新证据下，A 是罪犯的概率是多少？

由题目可以获得先验概率：如果某个“良民”犯罪的概率是 $b$，“惯犯”犯罪的概率是 $a$，则有：$10^4b+(10^6-10^4)a=1,a=cb$。即 $a=\frac{c}{10^4c+9.9\times10^4},b=\frac{1}{10^4c+9.9\times10^4}$。

列出贝叶斯公式还是简单的。用 $A$ 表示 A 是罪犯，$B$ 表示有且只有 A 匹配 DNA，则：

$$
\begin{aligned}
P(A \mid B) &= \frac{P(B\mid A)P(A)}{P(B)} \\
&= \frac{aP(B\mid A)}{P(B)}
\end{aligned}
$$

麻烦从这里开始。首先一个容易被直觉带偏的就是 $P(B \mid A)$，看似是 1，但如果考虑 $B$ 的定义，就会发现其实是 $(1-10^{-5})^{9999}$。另一个更麻烦的就是 $P(B)$。很容易简单地看成 $10^{-5}(1-10^{-5})^{9999}$（这就是定义嘛）。问题在于，定义说的是“正常人”，但如果 A 是罪犯，那就不是 $10^{-5}$ 而是 1。所以要继续根据 $A$ 的真假来分讨。使用全概率公式：

$$
\begin{aligned}
P(B) &= P(B \mid A) P(A) + P(B \mid A^c)P(A^c) \\
&= (1-10^{-5})^{9999}a + (1-a)P(B \mid A^c)
\end{aligned}
$$

别慌，如果你又把 $P(B \mid A^c)$ 当成了 $(1-10^{-5})^{9999}$，说明你还是被直觉骗了。$P(B \mid A)=(1-10^{-5})^{9999}$ 是因为如果 A 是罪犯那么别人都是“正常人”。但反之不然。如果 A 不是罪犯，其他“惯犯”也有可能是罪犯啊。所以一定不能轻信直觉。

设 $C$ 表示“所有惯犯都不是罪犯”。现在定义可以使用了，$P(B \mid C) = 10^{-5}(1-10^{-5})^{9999}$。注意到 $A^c \subset C$，并且 $P(B \mid A^cC^c)=0$（A 没犯罪但是惯犯犯罪，则必然有不是 A 的匹配，与 $B$ 矛盾）则继续用全概率公式：

$$
\begin{aligned}
P(B \mid A^c) &= P(B \mid A^cC) P(C \mid A^c) + P(B \mid A^cC^c)P(C^c \mid A^c) \\
&= P(B \mid C) \frac{P(CA^c)}{P(A^c)} + 0 \\
&= 10^{-5}(1-10^{-5})^{9999}\frac{1-10^4a}{1-a}
\end{aligned}
$$

综上，我们求的概率是 $P(A \mid B)=\frac{a}{a+10^{-5}(1-10^4a)}=\frac{1}{0.9+\frac{10^{-5}}{a}}$。

这个例子里的种种坑都是把某一个条件概率当成总概率使用导致的。所以要看清定义，并且多用一用全概率公式，不要想当然。